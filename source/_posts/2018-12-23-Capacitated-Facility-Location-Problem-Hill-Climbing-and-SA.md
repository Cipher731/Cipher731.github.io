---
title: Capacitated Facility Location Problem - Hill-Climbing and SA
date: 2018-12-23 22:35:06
tags: Python
mathjax: true
---

# 一、算法简述
我采用的两种算法分别是爬山法（Hill-Climbing）和模拟退火法（Simulated Annealing）。
实现了一个类用于描述问题的解并用于生成邻居，对应在solution.py文件中，主文件中就进行了具体的算法的实现。
爬山法和模拟退火法有相似之处，爬山法从当前解的所有邻居中采纳一个最优解，而模拟退火法对当前解随机选取一个邻居，根据一定的规律采纳：
1. 如果优于当前解，则采纳
2. 如果劣于当前解，则根据$P_k = 1 / (1 + e^{-\Delta E_k/T})$的概率采纳

由于第二条规则的存在，使得模拟退火法存在跳出局部最优的可能性。
在这两个算法中邻居的生成方法是重要的一环，在我的实现中，所有邻居由重新随机分配每个顾客来生成，每个邻居重新分配一个顾客，因此爬山法的邻居数目就是顾客数目。模拟退火法中的下一个解则是在所有这些邻居中随机选取一个，换句话说就是随机选取一个顾客并将他随机分配至新的设施。
在模拟退火法中，温度下降的函数以及初温的设定都是需要注意的地方，我所采用的降温函数是$T = T_0 / (1 + log(1 + k))$，其中k是外循环迭代轮数，每进行500次内循环就将外循环迭代次数加一，以实现降温。
由于涉及到很多样本，如果手动调整初温，很大几率无法顾全所有样本，因此需要选取一种设定初温的规则。
我所采用的设定初温的原则是在最初情况下使得没有提升的解被接受的概率是95%，具体操作就是选取初始解的100个非提升的邻居，计算耗费均值，根据这个值和需要的95%接受率来计算出初温。
在实际进行性能测试的时候，爬山法的速度要明显快于模拟退火法，这是因为在这种邻居定义下，邻居的数量与顾客数量相等，而爬山法的每次迭代都要遍历所有邻居，因此它的算法时间主要由邻居数量决定，随着顾客数量的增加，时间有显著的增长；模拟退火法每次迭代都只随机选取一个邻居，所以它的时间主要取决于总迭代次数，由于固定设置了500,000次迭代，所以所用时间的基数很大，同时也注意到尽管顾客数量在增加，但是运行时间上并没有出现显著的增长也是这个原因。
总体而言，模拟退火法最终解的质量都优于爬山法，因此在样本数量很大的时候，模拟退火法的优势就更明显。

# 二、结果
||hill-climbing result|hill-climbing time (s)|SA result|SA time (s)|
|-|-|-|-|-|
|p1|10928|0.03|10032|10.07|
|p2|9438|0.04|8917|10.14|
|p3|11611|0.04|11104|9.86|
|p4|14384|0.03|12441|9.93|
|p5|11304|0.03|10158|10.80|
|p6|10055|0.03|9032|10.28|
|p7|13147|0.03|10800|10.26|
|p8|13647|0.04|12903|10.52|
|p9|11022|0.03|10175|9.72|
|p10|9625|0.03|8927|9.68|
|p11|11331|0.03|10715|9.68|
|p12|13680|0.03|12124|9.69|
|p13|14065|0.03|9517|10.01|
|p14|10992|0.03|8181|10.00|
|p15|12721|0.04|9650|10.07|
|p16|15763|0.04|13053|9.97|
|p17|12718|0.03|10286|9.93|
|p18|11776|0.03|8517|9.97|
|p19|14036|0.04|11227|9.98|
|p20|16886|0.03|12088|9.98|
|p21|11558|0.04|9715|9.89|
|p22|10911|0.03|8017|9.89|
|p23|12500|0.04|10161|9.88|
|p24|15210|0.04|11803|9.95|
|p25|16490|0.47|13380|11.86|
|p26|13898|0.50|12327|11.91|
|p27|18295|0.52|14242|11.85|
|p28|23400|0.47|17178|11.89|
|p29|19256|0.46|13849|11.91|
|p30|14526|0.46|11949|11.89|
|p31|18001|0.51|15257|11.93|
|p32|21237|0.52|17402|11.89|
|p33|16549|0.50|13301|11.84|
|p34|14906|0.47|11844|11.84|
|p35|19728|0.46|14646|11.84|
|p36|22774|0.54|17640|11.92|
|p37|15882|0.50|13468|11.76|
|p38|12704|0.54|11513|11.78|
|p39|17425|0.51|14682|11.91|
|p40|23258|0.48|15972|11.79|
|p41|8966|0.12|8790|10.54|
|p42|9947|0.09|7345|10.34|
|p43|9039|0.07|7098|10.46|
|p44|12450|0.12|12056|10.68|
|p45|11201|0.10|9515|10.37|
|p46|10387|0.09|8982|10.55|
|p47|14008|0.10|13325|10.74|
|p48|12572|0.10|10969|10.46|
|p49|11481|0.06|8172|10.60|
|p50|9658|0.15|8871|10.80|
|p51|10308|0.16|8458|10.69|
|p52|15236|0.15|14835|10.72|
|p53|14980|0.15|12449|10.70|
|p54|15740|0.13|14798|10.86|
|p55|12623|0.19|11274|10.69|
|p56|29240|0.85|26223|12.71|
|p57|38653|0.86|34841|12.89|
|p58|58234|0.86|50246|12.81|
|p59|46647|0.66|38872|12.81|
|p60|30314|0.78|26449|12.73|
|p61|37580|0.77|32644|12.77|
|p62|59395|0.68|52376|12.74|
|p63|43768|0.82|38964|12.75|
|p64|29707|0.87|26792|12.77|
|p65|35575|0.95|34239|12.77|
|p66|58318|0.84|53027|12.74|
|p67|44074|0.84|40560|12.53|
|p68|28809|0.82|26783|12.50|
|p69|37346|0.82|34219|12.50|
|p70|55027|0.97|52980|12.56|
|p71|44077|0.92|40584|12.51|

# 三、代码
代码请参见[Github Repo](https://github.com/Cipher731/CFLP)。

# 四、详细解
详细解请参见[Github Repo](https://github.com/Cipher731/CFLP)中的hc和sa文件夹，分别对应爬山法和模拟退火法的解。